# tangnano20k-frmbuf_ham6

これは FPGAのtangnano20k で256x256x6bitのフレームバッファから AMIGA の HAM モードのように4096色表示するサンプルコードです。

gen_video.v 内でフレームバッファを表示するためのROMが定義されていて、そこから読み込んで HDMI 表示します。

PCから python を使って UART でパレットとビットマップデータを送りその情報を受け取ってフレームバッファの表示を変化させます。

エスケープ処理をするよりも安定して短いデータでデータ長付きの通信を可能とする COBS を用いて通信し、0が送られてきた場合はリセットがかかるような実装になっています。

frmbuf_p64 と同様に frmbuf_ham6 は 8192 バイト * 6 プレーンで構成されています。

8192 * 6 の連続した領域を取れなかったので 8192 * 4 のサイズと 8192 * 2 のサイズの２つの領域に分けてメモリを確保して場合わけでなんとか動かしてます。

HAMは2ビットがコントロールビットで00がパレット指定、01が青、10が赤、11が緑の輝度変更できるようにして輝度は16段階で4096色表示します。

conv.py で HAM形式に変換し、view.pyで表示して確認できます。

実機との通信は inp.py が HAM形式の画像を読み込んで UART で転送します。

## 参考文献

https://en.wikipedia.org/wiki/Hold-And-Modify
